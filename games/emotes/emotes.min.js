let loginButton,settingsOffcanvas,loginExpiredModal,aboutModal,voters=[],allEmotes={twitchGlobal:[],bttvGlobal:[],ffzGlobal:[],seventvGlobal:[],twitchChannel:[],bttvChannel:[],ffzChannel:[],seventvChannel:[]},elements={grid:document.getElementById("grid"),loginExpiredModal:document.getElementById("loginExpiredModal"),aboutModal:document.getElementById("aboutModal"),vtsLink:document.getElementById("vtsLink"),status:document.getElementById("status"),topRight:document.getElementById("topRight"),loginButton:document.getElementById("loginButton"),channelName:document.getElementById("channelName"),darkTheme:document.getElementById("darkTheme"),toastContainer:document.getElementById("toastContainer"),settingsOffcanvas:document.getElementById("settingsOffcanvas"),twitchGlobal:document.getElementById("twitchGlobal"),bttvGlobal:document.getElementById("bttvGlobal"),ffzGlobal:document.getElementById("ffzGlobal"),seventvGlobal:document.getElementById("seventvGlobal"),twitchChannel:document.getElementById("twitchChannel"),bttvChannel:document.getElementById("bttvChannel"),ffzChannel:document.getElementById("ffzChannel"),seventvChannel:document.getElementById("seventvChannel"),oneAnswer:document.getElementById("oneAnswer"),hideName:document.getElementById("hideName"),blurEmote:document.getElementById("blurEmote"),emotesPerRound:document.getElementById("emotesPerRound"),emotesPerRoundLabel:document.getElementById("emotesPerRoundLabel"),turnLength:document.getElementById("turnLength"),turnLengthLabel:document.getElementById("turnLengthLabel"),emoteTimer:document.getElementById("emoteTimer"),emoteTimerLabel:document.getElementById("emoteTimerLabel"),timerDecay:document.getElementById("timerDecay"),timerDecayLabel:document.getElementById("timerDecayLabel"),twitchGlobalCount:document.getElementById("twitchGlobalCount"),bttvGlobalCount:document.getElementById("bttvGlobalCount"),ffzGlobalCount:document.getElementById("ffzGlobalCount"),seventvGlobalCount:document.getElementById("seventvGlobalCount"),twitchChannelCount:document.getElementById("twitchChannelCount"),bttvChannelCount:document.getElementById("bttvChannelCount"),ffzChannelCount:document.getElementById("ffzChannelCount"),seventvChannelCount:document.getElementById("seventvChannelCount"),output:document.getElementById("output"),timeBar:document.getElementById("timeBar"),emotes:document.getElementById("emotes"),timer:document.getElementById("timer"),timerValue:document.getElementById("timerValue")},darkTheme=!0,USER={channel:"",twitchLogin:!1,access_token:"",userID:"",platform:""};function handleMessage(e,t,n,l){let a=!1;switch(EMOTEBENCHMARK.ebdifficulty){case 4:case 5:a=!0;break;default:break}a?voters.includes(t.username)||(voters.push(t.username),EMOTEBENCHMARK.answer.trim()):n==EMOTEBENCHMARK.answer.trim()&&((EMOTEBENCHMARK.qualified.includes(t.username)||1==EMOTEBENCHMARK.turn)&&(EMOTEBENCHMARK.qualifiedCurrentRound.includes(t.username)||EMOTEBENCHMARK.qualifiedCurrentRound.push(t.username)),elements.output.innerHTML=`Qualified players: ${EMOTEBENCHMARK.qualifiedCurrentRound.join(", ")}`)}let EMOTEBENCHMARK={interval:null,turn:0,turnLength:2e4,emotesPerRound:1,emoteTimer:2e3,timerDecay:80,oneAnswer:!1,hideName:!1,blurEmote:!1,answer:"",qualified:[],qualifiedCurrentRound:[],wrong:[],usedEmotes:[],timer:null,twitchGlobal:!1,bttvGlobal:!1,ffzGlobal:!1,seventvGlobal:!1,twitchChannel:!1,bttvChannel:!1,ffzChannel:!1,seventvChannel:!1};function start(){EMOTEBENCHMARK.emotesPerRound=parseInt(elements.emotesPerRound.value,10),EMOTEBENCHMARK.turnLength=1e3*parseInt(elements.turnLength.value,10),EMOTEBENCHMARK.emoteTimer=1e3*parseInt(elements.emoteTimer.value,10),EMOTEBENCHMARK.timerDecay=1e3*parseInt(elements.timerDecay.value,10),EMOTEBENCHMARK.oneAnswer=elements.oneAnswer.checked,EMOTEBENCHMARK.hideName=elements.hideName.checked,EMOTEBENCHMARK.blurEmote=elements.blurEmote.checked,EMOTEBENCHMARK.interval?console.log("interval already running"):(startTurn(),startTimer(),EMOTEBENCHMARK.interval=setInterval(startTurn,EMOTEBENCHMARK.turnLength))}function reset(){clearInterval(EMOTEBENCHMARK.interval),EMOTEBENCHMARK.interval=null,EMOTEBENCHMARK.turn=0,EMOTEBENCHMARK.answer="",elements.emotes.innerHTML="",elements.output.innerHTML="",elements.timeBar.style.display="none",EMOTEBENCHMARK.qualified=[],EMOTEBENCHMARK.qualifiedCurrentRound=[],EMOTEBENCHMARK.twitchGlobal=!1,EMOTEBENCHMARK.bttvGlobal=!1,EMOTEBENCHMARK.ffzGlobal=!1,EMOTEBENCHMARK.seventvGlobal=!1,EMOTEBENCHMARK.twitchChannel=!1,EMOTEBENCHMARK.bttvChannel=!1,EMOTEBENCHMARK.ffzChannel=!1,EMOTEBENCHMARK.seventvChannel=!1,elements.twitchGlobal.checked=!1,elements.bttvGlobal.checked=!1,elements.ffzGlobal.checked=!1,elements.seventvGlobal.checked=!1,elements.twitchChannel.checked=!1,elements.bttvChannel.checked=!1,elements.ffzChannel.checked=!1,elements.seventvChannel.checked=!1,elements.oneAnswer.checked=!1,elements.hideName.checked=!1,elements.blurEmote.checked=!1,elements.emotesPerRound.value=1,elements.emotesPerRoundLabel.innerHTML="1",elements.turnLength.value=20,elements.turnLengthLabel.innerHTML="20",elements.emoteTimer.value=2,elements.emoteTimerLabel.innerHTML="2",elements.timerDecay.value=80,elements.timerDecayLabel.innerHTML="80",EMOTEBENCHMARK.usedEmotes=[]}function startTurn(){EMOTEBENCHMARK.turn++,startTimer();let e=[],t=[];if(EMOTEBENCHMARK.answer="",elements.emotes.innerHTML="",EMOTEBENCHMARK.qualified=EMOTEBENCHMARK.qualifiedCurrentRound,EMOTEBENCHMARK.qualifiedCurrentRound=[],1==EMOTEBENCHMARK.qualified.length)return elements.output.innerHTML=`Game is over. WINNER: ${EMOTEBENCHMARK.qualified.join(", ")}`,stopTimer(),clearInterval(EMOTEBENCHMARK.interval),EMOTEBENCHMARK.interval=null,void(EMOTEBENCHMARK.turn=0);if(elements.output.innerHTML=`Qualified players: ${EMOTEBENCHMARK.qualified.join(", ")}`,0==EMOTEBENCHMARK.qualified.length&&EMOTEBENCHMARK.turn>1)return elements.output.innerHTML="Game is over. No one won",stopTimer(),clearInterval(EMOTEBENCHMARK.interval),EMOTEBENCHMARK.interval=null,void(EMOTEBENCHMARK.turn=0);if(EMOTEBENCHMARK.twitchGlobal&&allEmotes.twitchGlobal.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.bttvGlobal&&allEmotes.bttvGlobal.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.ffzGlobal&&allEmotes.ffzGlobal.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.seventvGlobal&&allEmotes.seventvGlobal.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.twitchChannel&&allEmotes.twitchChannel.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.bttvChannel&&allEmotes.bttvChannel.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.ffzChannel&&allEmotes.ffzChannel.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.seventvChannel&&allEmotes.seventvChannel.forEach((t=>{e.push(t)})),EMOTEBENCHMARK.usedEmotes.forEach((t=>{e=e.filter((e=>e.name!=t))})),e.length<5)return stopTimer(),elements.timeBar.style.display="none",clearInterval(EMOTEBENCHMARK.interval),EMOTEBENCHMARK.interval=null,EMOTEBENCHMARK.turn=0,showToast("Not enough emotes remaining.","warning",5e3),void settingsOffcanvas.show();for(let n=0;n<EMOTEBENCHMARK.emotesPerRound;n++)t.push(e[Math.floor(Math.random()*e.length)]),t.forEach((e=>{EMOTEBENCHMARK.usedEmotes.push(e.name)}));elements.emotes.style.opacity=0;for(let e=0;e<t.length;e++){let n="";EMOTEBENCHMARK.hideName||(n=`<div class="text-body-secondary text-center">${t[e].name}</div>`),elements.emotes.innerHTML+=`<div class="border border-secondary emote">\n          <img src="${t[e].url}" alt="${t[e].name}" title="${t[e].name}">\n          ${n}\n          </div>`,EMOTEBENCHMARK.answer+=`${t[e].name} `}elements.output.innerHTML="Qualified players:",elements.timeBar.style.display="block",elements.timeBar.style.width="100%",setTimeout((()=>{elements.emotes.style.opacity=1,$("#timeBar").animate({width:"0px"},EMOTEBENCHMARK.emoteTimer-100*EMOTEBENCHMARK.turn)}),2e3),setTimeout((()=>{elements.emotes.style.opacity=0}),2e3+EMOTEBENCHMARK.emoteTimer-100*EMOTEBENCHMARK.turn)}function startTimer(){elements.timer.style.display="",EMOTEBENCHMARK.timer&&EMOTEBENCHMARK.timer.isRunning()&&(EMOTEBENCHMARK.timer.reset(),EMOTEBENCHMARK.timer.stop()),isNaN(EMOTEBENCHMARK.turnLength)||0!=EMOTEBENCHMARK.turnLength&&(EMOTEBENCHMARK.timer=new easytimer.Timer,EMOTEBENCHMARK.timer.addEventListener("secondTenthsUpdated",(function(e){elements.timerValue.innerHTML="Round ends in "+EMOTEBENCHMARK.timer.getTimeValues().toString(["minutes","seconds","secondTenths"])})),EMOTEBENCHMARK.timer.addEventListener("targetAchieved",(function(e){elements.timerValue.innerHTML=`Round #${EMOTEBENCHMARK.turn} starting...`,EMOTEBENCHMARK.timer.reset(),EMOTEBENCHMARK.timer.stop()})),elements.timerValue.innerHTML=`Round #${EMOTEBENCHMARK.turn} starting...`,setTimeout((()=>{EMOTEBENCHMARK.timer.start({countdown:!0,precision:"secondTenths",startValues:{seconds:EMOTEBENCHMARK.turnLength/1e3-2}})}),2e3))}function stopTimer(){EMOTEBENCHMARK.timer&&EMOTEBENCHMARK.timer.isRunning()&&(EMOTEBENCHMARK.timer.reset(),EMOTEBENCHMARK.timer.stop()),elements.timer.style.display="none"}window.onload=async function(){darkTheme="true"===(localStorage.getItem("darkTheme")||"true"),elements.darkTheme.checked=darkTheme??!0,switchTheme(elements.darkTheme.checked),loadAndConnect(),USER.channel||(loginButton=new bootstrap.Popover(elements.loginButton)),loginExpiredModal=new bootstrap.Modal(elements.loginExpiredModal),aboutModal=new bootstrap.Modal(elements.aboutModal),settingsOffcanvas=new bootstrap.Offcanvas(elements.settingsOffcanvas),enableTooltips(),enablePopovers(),elements.channelName.addEventListener("keydown",(e=>{"Enter"===e.key&&connect()})),elements.darkTheme.onchange=function(){switchTheme(this.checked),saveSettings()},elements.twitchGlobal.onchange=function(){EMOTEBENCHMARK.twitchGlobal=this.checked},elements.bttvGlobal.onchange=function(){EMOTEBENCHMARK.bttvGlobal=this.checked},elements.ffzGlobal.onchange=function(){EMOTEBENCHMARK.ffzGlobal=this.checked},elements.seventvGlobal.onchange=function(){EMOTEBENCHMARK.seventvGlobal=this.checked},elements.twitchChannel.onchange=function(){EMOTEBENCHMARK.twitchChannel=this.checked},elements.bttvChannel.onchange=function(){EMOTEBENCHMARK.bttvChannel=this.checked},elements.ffzChannel.onchange=function(){EMOTEBENCHMARK.ffzChannel=this.checked},elements.seventvChannel.onchange=function(){EMOTEBENCHMARK.seventvChannel=this.checked},elements.emotesPerRound.oninput=function(){elements.emotesPerRoundLabel.innerHTML=this.value},elements.turnLength.oninput=function(){elements.turnLengthLabel.innerHTML=this.value},elements.emoteTimer.oninput=function(){elements.emoteTimerLabel.innerHTML=this.value},elements.timerDecay.oninput=function(){elements.timerDecayLabel.innerHTML=this.value},allEmotes.twitchGlobal=await getGlobalTwitchEmotes(!0),allEmotes.bttvGlobal=await getGlobalBTTVEmotes(!0),allEmotes.ffzGlobal=await getGlobalFFZEmotes(!0),allEmotes.seventvGlobal=await getGlobal7TVEmotes(!0),elements.twitchGlobalCount.innerHTML=`<br>${allEmotes.twitchGlobal.length} emotes`,elements.bttvGlobalCount.innerHTML=`<br>${allEmotes.bttvGlobal.length} emotes`,elements.ffzGlobalCount.innerHTML=`<br>${allEmotes.ffzGlobal.length} emotes`,elements.seventvGlobalCount.innerHTML=`<br>${allEmotes.seventvGlobal.length} emotes`,USER.channel&&(allEmotes.twitchChannel=await getChannelTwitchEmotes(USER.channel,!0),allEmotes.bttvChannel=await getChannelBTTVEmotes(USER.userID,!0),allEmotes.ffzChannel=await getChannelFFZEmotes(USER.userID,!0),allEmotes.seventvChannel=await getChannel7TVEmotes(USER.userID,!0),elements.twitchChannelCount.innerHTML=`<br>${allEmotes.twitchChannel.length} emotes`,elements.bttvChannelCount.innerHTML=`<br>${allEmotes.bttvChannel.length} emotes`,elements.ffzChannelCount.innerHTML=`<br>${allEmotes.ffzChannel.length} emotes`,elements.seventvChannelCount.innerHTML=`<br>${allEmotes.seventvChannel.length} emotes`)};