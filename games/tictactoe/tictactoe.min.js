let loginButton,loginExpiredModal,aboutModal,streamersTurn=!0,voters=[],elements={grid:document.getElementById("grid"),gameDiv:document.getElementById("gameDiv"),loginExpiredModal:document.getElementById("loginExpiredModal"),aboutModal:document.getElementById("aboutModal"),vtsLink:document.getElementById("vtsLink"),status:document.getElementById("status"),topRight:document.getElementById("topRight"),loginButton:document.getElementById("loginButton"),channelName:document.getElementById("channelName"),connectbtn:document.getElementById("connectbtn"),darkTheme:document.getElementById("darkTheme"),toastContainer:document.getElementById("toastContainer")},darkTheme=!0,USER={channel:"",twitchLogin:!1,access_token:"",userID:"",platform:""};function connect(){elements.status.innerHTML='\n  <h4>\n  <span class="badge bg-warning">Connecting... \n  <div class="spinner-border" style="width:18px;height:18px;" role="status"><span class="visually-hidden">Loading...</span></div>\n  </span>\n  </h4>',elements.topRight.innerHTML='\n  <div class="btn-group" role="group" aria-label="log in button group">\n  <button type="button" class="btn btn-twitch"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></button>\n  <div class="btn-group" role="group">\n  <button id="btnGroupDropLogin" type="button" class="btn btn-twitch dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"></button>\n  <ul class="dropdown-menu dropdown-menu-lg-end" aria-labelledby="btnGroupDrop1">\n  <li><a class="dropdown-item" onclick="logout()" href="#"><i class="material-icons notranslate">logout</i>Log out</a></li>\n  </ul>\n  </div>\n  </div>',refreshData();let e={options:{clientId:CLIENT_ID,debug:!1},connection:{secure:!0,reconnect:!0},channels:[USER.channel]};client=new tmi.client(e),client.on("message",(async(e,t,n,a)=>{let l=n.split(" ").filter(Boolean);if(streamersTurn)return;let s=parseInt(l[0],10);if(!isNaN(s)&&s>0&&s<10&&!voters.includes(t.username)){if(TTT.gameBoard[s-1])return;voters.push(t.username);let e=TTT.results.findIndex((e=>e.label==s));return TTT.results[e].data+=1,void updateGraph("ttt")}})),client.on("timeout",((e,t,n,a,l)=>{})),client.on("connected",(async(e,t)=>{elements.status.innerHTML='<h4><span class="badge bg-success">Connected :)</span></h4>',saveSettings(),sendUsername("chat.vote/games/tictactoe",USER.channel,"twitch"==USER.platform?`twitch - ${USER.twitchLogin}`:"youtube"),await checkTags(USER.userID,USER.access_token)&&(elements.vtsLink.style.display=""),loadPFP()})),client.on("disconnected",(e=>{elements.status.innerHTML=`<h4><span class="badge bg-danger">Disconnected: ${e}</span></h4>`})),client.on("notice",((e,t,n)=>{elements.status.innerHTML=`<h4><span class="badge bg-danger">Disconnected: ${n}</span></h4>`})),client.connect().catch(console.error)}function initGraph(){TTT.chart&&TTT.chart.destroy(),TTT.chart=new Chart(TTT.ctx,{type:"bar",data:{labels:["1 - 0 Votes (0%)","2 - 0 Votes (0%)","3 - 0 Votes (0%)","4 - 0 Votes (0%)","5 - 0 Votes (0%)","6 - 0 Votes (0%)","7 - 0 Votes (0%)","8 - 0 Votes (0%)","9 - 0 Votes (0%)"],datasets:[{label:"score",data:[],borderWidth:2}]},options:{indexAxis:"y",maintainAspectRatio:!1,scales:{x:{ticks:{color:"white"},beginAtZero:!0},y:{ticks:{textStrokeColor:"rgba(0,0,0,1)",textStrokeWidth:3,color:"white",mirror:!0,font:{size:32},z:1},beginAtZero:!0}},plugins:{tooltip:{enabled:!1},legend:{display:!1}}}})}function updateGraph(){let e,t,n,a;e=TTT.results.map((e=>e.label)),t=TTT.results.map((e=>e.data)),n=TTT.results.map((e=>e.c1)),a=TTT.results.map((e=>e.c2));let l=[],s=0;for(let s=0;s<t.length;s++)l.push({data:t[s],label:e[s],c1:n[s],c2:a[s]});for(let o=0;o<l.length;o++)t[o]=l[o].data,e[o]=`${l[o].label} - ${l[o].data} ${1==l[o].data?"Vote":"Votes"} (${Math.round(l[o].data/voters.length*100)||0}%)`,n[o]=l[o].c1,a[o]=l[o].c2,s+=l[o].data;document.getElementById("totalvotesttt").innerHTML=`Total votes: ${s}`,TTT.chart.data.labels=e,TTT.chart.data.datasets.forEach((e=>{e.data=t,e.backgroundColor=n,e.borderColor=a})),TTT.chart.update()}window.onload=function(){darkTheme="true"===(localStorage.getItem("darkTheme")||"true"),elements.darkTheme.checked=darkTheme??!0,switchTheme(elements.darkTheme.checked),loadAndConnect(),USER.channel||(loginButton=new bootstrap.Popover(elements.loginButton)),loginExpiredModal=new bootstrap.Modal(elements.loginExpiredModal),aboutModal=new bootstrap.Modal(elements.aboutModal),enableTooltips(),enablePopovers(),elements.channelName.addEventListener("keydown",(e=>{"Enter"===e.key&&connect()})),elements.connectbtn.addEventListener("click",(function(){connect()})),elements.darkTheme.onchange=function(){switchTheme(this.checked),saveSettings()},initGraph(),listeners(),document.getElementById("tttoverlay").innerHTML=`<span class="overlaytext">${USER.channel||"STREAMER"}'s turn</span>`};let TTT={chart:null,isComputerPlaying:!1,isGameOver:!1,gameBoard:[null,null,null,null,null,null,null,null,null],squares:$(".square"),ctx:document.getElementById("tttchartCanvas").getContext("2d"),results:[{label:"1",data:0,c1:"#f44336",c2:"#f53337"},{label:"2",data:0,c1:"#f4c236",c2:"#f5c237"},{label:"3",data:0,c1:"#a8f436",c2:"#a9e437"},{label:"4",data:0,c1:"#36f443",c2:"#37e444"},{label:"5",data:0,c1:"#36f4c2",c2:"#37e4c3"},{label:"6",data:0,c1:"#36a8f4",c2:"#3798f5"},{label:"7",data:0,c1:"#4336f4",c2:"#4426f5"},{label:"8",data:0,c1:"#a236d4",c2:"#a326d5"},{label:"9",data:0,c1:"#f336b8",c2:"#f426b9"}],winningCombos:[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]],pieceClasses:{X:"text-success",O:"text-warning"}};function updateGameBoard(e,t,n){TTT.gameBoard[e]=t,n.html(t),n.addClass([TTT.pieceClasses[t],"text-shadow"]);let a=document.getElementsByClassName("choices");for(let e=0,t=a.length;e<t;e++)a[e].innerHTML=0,TTT.gameBoard[e]&&$(a[e]).parent().addClass("text-body-secondary")}function reset(){init(),TTT.squares.removeClass(["text-shadow"].concat(Object.values(TTT.pieceClasses))),document.getElementById("totalvotesttt").innerHTML="Total votes: 0",document.getElementById("tttoutput").innerHTML="",document.getElementById("tttchartCanvas").classList="blur",document.getElementById("tttoverlay").innerHTML=`<span class="overlaytext">${USER.channel||"STREAMER"}'s turn</span>`,TTT.results=[{label:"1",data:0,c1:"#f44336",c2:"#f53337"},{label:"2",data:0,c1:"#f4c236",c2:"#f5c237"},{label:"3",data:0,c1:"#a8f436",c2:"#a9e437"},{label:"4",data:0,c1:"#36f443",c2:"#37e444"},{label:"5",data:0,c1:"#36f4c2",c2:"#37e4c3"},{label:"6",data:0,c1:"#36a8f4",c2:"#3798f5"},{label:"7",data:0,c1:"#4336f4",c2:"#4426f5"},{label:"8",data:0,c1:"#a236d4",c2:"#a326d5"},{label:"9",data:0,c1:"#f336b8",c2:"#f426b9"}]}function init(){for(let e=0,t=TTT.squares.length;e<t;e++)TTT.squares[e].innerHTML=`<span class="text-body-secondary">${e+1}</span>`;TTT.gameBoard=[null,null,null,null,null,null,null,null,null],TTT.isComputerPlaying=!1,TTT.isGameOver=!1,document.getElementById("gameboard").classList="pointer"}function checkWin(e){for(let t=0,n=TTT.winningCombos.length;t<n;t++)if(TTT.winningCombos[t].every((t=>TTT.gameBoard[t]===e)))return endGame(e);return!!TTT.gameBoard.every((e=>null!==e))&&endGame("draw")}function endGame(e){return document.getElementById("tttoutput").innerHTML="X"===e?`${USER.channel} wins<br> <button type="button" onclick="resetGame()" class="btn btn-primary">Play again</button>`:"O"===e?'Chat wins<br> <button type="button" onclick="resetGame()" class="btn btn-primary">Play again</button>':'Draw<br> <button type="button" onclick="resetGame()" class="btn btn-primary">Play again</button>',TTT.isGameOver=!0,!0}function getChatMove(){let e=TTT.results;return e.sort((function(e,t){return e.data>t.data?-1:e.data==t.data?0:1})),e[0]}function playTurn(){if(0==voters.length)return;streamersTurn=!0,document.getElementById("tttchartCanvas").classList="blur",document.getElementById("tttoverlay").innerHTML=`<span class="overlaytext">${USER.channel||"STREAMER"}'s turn</span>`,voters=[];let e=getChatMove();e=e.label,TTT.results=TTT.results.filter((function(t){return t.label!=e})),TTT.results.forEach(((e,t)=>{TTT.results[t].data=0})),TTT.results.sort((function(e,t){return parseInt(e.label,10)<parseInt(t.label,10)?-1:parseInt(e.label,10)==parseInt(t.label,10)?0:1})),updateGraph("ttt");let t=$(".square-0"+(parseInt(e,10)-1));updateGameBoard(""+(parseInt(e,10)-1),"O",t),checkWin("O")&&(document.getElementById("tttoverlay").innerHTML=""),TTT.isComputerPlaying=!1,document.getElementById("gameboard").classList="cursorpointer",document.getElementById("totalvotesttt").innerHTML="Total votes: 0"}function listeners(){TTT.squares.click((function(){let e=parseInt($(this).data("index"),10);TTT.isGameOver||TTT.isComputerPlaying||null!==TTT.gameBoard[e]||(streamersTurn=!1,voters=[],document.getElementById("gameboard").classList="cursordefault",document.getElementById("tttchartCanvas").classList="",document.getElementById("tttoverlay").innerHTML="",updateGameBoard(e,"X",$(this)),checkWin("X"),TTT.isComputerPlaying=!0,TTT.results=TTT.results.filter((t=>t.label!=`${e+1}`)),TTT.results.forEach(((e,t)=>{TTT.results[t].data=0})),updateGraph("ttt"))}))}function resetGame(){voters=[],initGraph(),streamersTurn=!0,reset()}