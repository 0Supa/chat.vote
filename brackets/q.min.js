let rejectModal,unapproveModal,elements={rejectModal:document.getElementById("rejectModal"),reason:document.getElementById("reason"),unapproveModal:document.getElementById("unapproveModal"),unapproveReason:document.getElementById("unapproveReason"),toastContainer:document.getElementById("toastContainer"),unapproved:document.getElementById("unapproved"),approved:document.getElementById("approved"),rejected:document.getElementById("rejected")};async function approve(e){let t={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:e}),redirect:"follow"};try{let e=await fetch("https://brackets.pepega.workers.dev/approve",t),o=await e.json();showToast(o.message,"info",3e3),loadUnapproved(),loadApproved(),loadRejected()}catch(e){showToast("Could not approve bracket","danger",3e3)}}async function unreject(e){let t={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:e}),redirect:"follow"};try{let e=await fetch("https://brackets.pepega.workers.dev/unreject",t),o=await e.json();showToast(o.message,"info",3e3),loadUnapproved(),loadApproved(),loadRejected()}catch(e){showToast("Could not unreject bracket","danger",3e3)}}let rejectID="";function reject(e){rejectID=e,rejectModal.show()}async function rejectSubmit(){let e={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:rejectID,reason:elements.reason.value}),redirect:"follow"};try{let t=await fetch("https://brackets.pepega.workers.dev/reject",e),o=await t.json();showToast(o.message,"info",3e3),rejectModal.hide(),loadUnapproved(),loadApproved(),loadRejected()}catch(e){showToast("Could not reject bracket","danger",3e3)}}let unapproveID="";function unapprove(e){unapproveID=e,unapproveModal.show()}async function unapproveSubmit(){let e={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:unapproveID,reason:elements.unapproveReason.value}),redirect:"follow"};try{let t=await fetch("https://brackets.pepega.workers.dev/unapprove",e),o=await t.json();showToast(o.message,"info",3e3),unapproveModal.hide(),loadUnapproved(),loadApproved(),loadRejected()}catch(e){showToast("Could not unapprove bracket","danger",3e3)}}async function loadUnapproved(){elements.unapproved.innerHTML=spinner;let e={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},redirect:"follow"};try{let t=await fetch("https://brackets.pepega.workers.dev/unapproved",e),o=await t.json();if(0==o.length)return void(elements.unapproved.innerHTML="No brackets in queue :)");let n="";for(let e=0;e<o.length;e++){n+=`\n      <div class="card">\n      <div class="card-header">${o[e].id} - ${o[e].username} - ${o[e].userid} - ${o[e].time}</div>\n      <div class="card-body">\n      <h5 class="card-title">${o[e].bracket.title}</h5>\n      <p class="card-text">${o[e].bracket.description}</p>\n      Options(${o[e].bracket.options.length}):\n      <ul class="list-group" style="max-height: 500px; overflow: auto">`;for(let t=0;t<o[e].bracket.options.length;t++)n+=`<li class="list-group-item">${o[e].bracket.options[t].name} - ${o[e].bracket.options[t].value}</li>`;n+=`\n      </ul>\n      <button type="button" class="btn btn-success float-end mt-3" onclick="approve('${o[e].id}')">Approve</button>\n      <button type="button" class="btn btn-danger float-end mt-3 me-2" onclick="reject('${o[e].id}')">Reject</button>\n      </div>\n      </div>`}elements.unapproved.innerHTML=n,linkifyElementID("unapproved")}catch(e){showToast("Could not load unapproved","danger",3e3)}}async function loadApproved(){elements.approved.innerHTML=spinner;let e={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},redirect:"follow"};try{let t=await fetch("https://brackets.pepega.workers.dev/approved",e),o=await t.json();if(0==o.length)return void(elements.approved.innerHTML="No approved brackets found :(");let n="";n+=`\n      <div class="card">\n      <div class="card-header">${o.length} approved brackets</div>\n      <div class="card-body">\n      <ul class="list-group" style="max-height: 500px; overflow: auto">`;for(let e=0;e<o.length;e++)n+=`\n      <li class="list-group-item">${o[e].id} - ${o[e].username} - ${o[e].bracket.title} - ${o[e].bracket.description} - ${o[e].bracket.options.length} options \n      <button type="button" class="btn btn-danger float-end mt-3 me-2" onclick="unapprove('${o[e].id}')">Unapprove</button>\n      </li>`;n+="\n    </ul>\n    </div>\n    </div>",elements.approved.innerHTML=n,linkifyElementID("approved")}catch(e){showToast("Could not load approved","danger",3e3)}}async function loadRejected(){elements.rejected.innerHTML=spinner;let e={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},redirect:"follow"};try{let t=await fetch("https://brackets.pepega.workers.dev/rejected",e),o=await t.json();if(0==o.length)return void(elements.rejected.innerHTML="No rejected brackets found :)");let n="";n+=`\n      <div class="card">\n      <div class="card-header">${o.length} rejected brackets</div>\n      <div class="card-body">\n      <ul class="list-group" style="max-height: 500px; overflow: auto">`;for(let e=0;e<o.length;e++)n+=`\n      <li class="list-group-item">${o[e].id} - ${o[e].username} - reject reason: ${o[e].reason} -  ${o[e].bracket.title} - ${o[e].bracket.description} - ${o[e].bracket.options.length} options \n      <button type="button" class="btn btn-danger float-end mt-3 me-2" onclick="unreject('${o[e].id}')">Unreject</button>\n      </li>`;n+="\n    </ul>\n    </div>\n    </div>",elements.rejected.innerHTML=n,linkifyElementID("rejected")}catch(e){showToast("Could not load rejected","danger",3e3)}}window.onload=async function(){let e={method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},redirect:"follow"};try{let t=await fetch("https://brackets.pepega.workers.dev/check",e),o=await t.json();if(200!==t.status||"OK"!==o.message)return void alert("You don't have permission to view this page")}catch(e){return void alert("You don't have permission to view this page")}loadUnapproved(),loadApproved(),loadRejected(),rejectModal=new bootstrap.Modal(elements.rejectModal),unapproveModal=new bootstrap.Modal(elements.unapproveModal)};