const CLIENT_ID="qn0wimnszbqlwfnszdz3wwfz430eqr",CLIENT_ID_YT="975425654977-2ckljuapg94eukqrnm1rgqup5npo95m9.apps.googleusercontent.com",API_KEY_YT="AIzaSyAMCaIslOwxlmotLsNN4NB2ia949h4GLP0",GETrequestOptions={method:"GET",redirect:"follow"},spinner='<div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div>';let channelBadges={subscriber:[],bits:[]},globalBadges={},customBadges=[];async function get7TVPFP(e){return e?new Promise((async function(t,a){try{let a=await fetch(`https://7tv.io/v3/users/twitch/${e}`,GETrequestOptions);200!==a.status&&t("/pics/donk.png");let s=await a.json();t(s?.user?.avatar_url?s.user.avatar_url:"/pics/donk.png")}catch(e){t("/pics/donk.png"),console.log("getprofilepic 7tv error",e)}})):"/pics/donk.png"}async function getTwitchPFP(e,t){let a=new Headers;a.append("client-id",CLIENT_ID),a.append("Authorization",`Bearer ${t}`);let s={method:"GET",headers:a,redirect:"follow"};return new Promise((async function(t,a){try{let a=await fetch(`https://api.twitch.tv/helix/users?login=${e}`,s);t((await a.json()).data[0].profile_image_url)}catch(e){t("/pics/donk.png"),console.log("getprofilepic twitch error",e)}}))}async function getGlobalTwitchEmotes(e=!1){let t=[];try{let a=await fetch("https://api.okayeg.com/emotes/global",GETrequestOptions),s=await a.json(),o=["R-)",";-p",";p",";-P",":-p",":p",":-P",";-)",":-\\",":\\",":-/",":-o",":o",":-O","8-)","B-)","o.o","o_o","o.O","o_O","O.O","O_O","O.o",":-Z",":Z",":-z",":z",":-|",":-D",":-(",":-)"];for(let a=0,n=s.data.length;a<n;a++)o.includes(s.data[a].name)||t.push({name:s.data[a].name,url:`https://static-cdn.jtvnw.net/emoticons/v2/${s.data[a].id}/default/dark/${e?"3.0":"1.0"}`});return t}catch(e){return console.log("getGlobalTwitchEmotes error",e),[]}}async function getGlobalBTTVEmotes(e=!1){let t=[],a=["SoSnowy","IceCold","SantaHat","TopHat","ReinDeer","CandyCane","cvMask","cvHazmat"];try{let s=await fetch("https://api.betterttv.net/3/cached/emotes/global",GETrequestOptions),o=await s.json();for(let s=0,n=o.length;s<n;s++)t.push({name:o[s].code,url:`https://cdn.betterttv.net/emote/${o[s].id}/${e?"3x":"1x"}`,zerowidth:a.includes(o[s].code)});return t}catch(e){return console.log("getGlobalBTTVEmotes error",e),[]}}async function getGlobalFFZEmotes(e=!1){let t=[];try{let a=await fetch("https://api.frankerfacez.com/v1/set/global",GETrequestOptions),s=await a.json();for(let a=0;a<s.default_sets.length;a++){let o=s.default_sets[a];for(let a=0,n=s.sets[o].emoticons.length;a<n;a++){let n=s.sets[o].emoticons[a],r=n.urls[e?"4":"1"];n.animated&&(r=n.animated[e?"4":"1"]),t.push({name:n.name,url:r,zerowidth:!1})}}return t}catch(e){return console.log("getGlobalFFZEmotes error",e),[]}}async function getGlobal7TVEmotes(e=!1){let t=[];try{let a=await fetch("https://7tv.io/v3/emote-sets/global",GETrequestOptions),s=await a.json();for(let a=0,o=s.emotes.length;a<o;a++){let o=s.emotes[a].data.host.files.filter((e=>"AVIF"==e.format));t.push({name:s.emotes[a].name,url:`${s.emotes[a].data.host.url}/${o[e?3:0].name}`,zerowidth:1==s.emotes[a].flags})}return t}catch(e){return console.log("getGlobal7TVEmotes error",e),[]}}async function getEmoji(){let e=[];try{let t=await fetch("/games/emoji.json",GETrequestOptions),a=await t.json();for(let t=0,s=a.length;t<s;t++)e.push({name:a[t].emoji,desc:a[t].description,url:"emoji"});return e}catch(e){return console.log("getEmoji error",e),[]}}async function getChannelTwitchEmotes(e,t=!1){let a=[];try{let s=await fetch(`https://api.okayeg.com/emotes?channel=${e}`,GETrequestOptions),o=await s.json();if(o.data.id&&o.data.emotes.length>0){for(let e=0,s=o.data.emotes.length;e<s;e++)a.push({name:o.data.emotes[e].name,url:`https://static-cdn.jtvnw.net/emoticons/v2/${o.data.emotes[e].id}/default/dark/${t?"3.0":"1.0"}`});return a}}catch(e){return console.log("getChannelTwitchEmotes error",e),[]}}async function getChannelBTTVEmotes(e,t=!1){if(!e)return[];let a=[];try{let s=await fetch(`https://api.betterttv.net/3/cached/users/twitch/${e}`,GETrequestOptions);if(200!==s.status)return[];let o=await s.json();if("user not found"!=o?.message){for(let e=0,s=o.channelEmotes.length;e<s;e++)a.push({name:o.channelEmotes[e].code,url:`https://cdn.betterttv.net/emote/${o.channelEmotes[e].id}/${t?"3x":"1x"}`,zerowidth:!1});for(let e=0,s=o.sharedEmotes.length;e<s;e++)a.push({name:o.sharedEmotes[e].code,url:`https://cdn.betterttv.net/emote/${o.sharedEmotes[e].id}/${t?"3x":"1x"}`,zerowidth:!1});return a}return[]}catch(e){return console.log("getChannelBTTVEmotes error",e),[]}}async function getChannelFFZEmotes(e,t=!1){let a=[];try{let s=await fetch(`https://api.frankerfacez.com/v1/room/id/${e}`,GETrequestOptions);if(200!==s.status)return[];let o=await s.json(),n=o.room.set,r=o.sets[n];for(let e=0,s=r.emoticons.length;e<s;e++){let s=r.emoticons[e].urls[t?"4":"1"];r.emoticons[e].animated&&(s=r.emoticons[e].animated[t?"4":"1"]),a.push({name:r.emoticons[e].name,url:s,zerowidth:!1})}return a}catch(e){return console.log("getChannelFFZEmotes error",e),[]}}async function getChannel7TVEmotes(e,t=!1){if(!e)return[];let a=[];try{let s=await fetch(`https://7tv.io/v3/users/twitch/${e}`,GETrequestOptions);if(200!==s.status)return[];let o=await s.json();for(let e=0,s=o.emote_set.emotes.length;e<s;e++){let s=o.emote_set.emotes[e].data.host.files.filter((e=>"AVIF"==e.format));a.push({name:o.emote_set.emotes[e].name,url:`${o.emote_set.emotes[e].data.host.url}/${s[t?3:0].name}`,zerowidth:1==o.emote_set.emotes[e].flags})}return a}catch(e){return console.log("getChannel7TVEmotes error",e),[]}}function showToast(e,t,a){let s=Date.now(),o=`<div id="${s}" class="toast align-items-center text-bg-${t} border-0" role="alert" data-bs-autohide="false" aria-live="assertive" aria-atomic="true">\n      <div class="d-flex">\n      <div class="toast-body" style="font-size:1.2em">${e}</div>\n      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n      </div>\n      </div>`;elements.toastContainer.innerHTML+=o;let n=[].slice.call(document.querySelectorAll(".toast")).map((function(e){return new bootstrap.Toast(e,{animation:!1,autohide:!1})}));n[n.length-1].show(),setTimeout((function(){n[n.length-1].hide(),document.getElementById(s).remove()}),a)}async function checkTags(e,t){if(!t||!e)return!1;let a=new Headers;a.append("client-id",CLIENT_ID),a.append("Authorization",`Bearer ${t}`);let s={method:"GET",headers:a,redirect:"follow"};return new Promise((async function(t,a){try{let a=await fetch(`https://api.twitch.tv/helix/channels?broadcaster_id=${e}`,s),o=await a.json();if(!o.data[0].tags||0==o.data[0].tags.length)return;let n=["브이튜버","pngtuber","버튜버","버츄얼","vstreamer","ｖtuber","live2d"];for(let e=0;e<o.data[0].tags.length;e++){let a=o.data[0].tags[e].toLowerCase();a.includes("vtube")&&t(!0),n.includes(a)&&t(!0)}t(!1)}catch(e){t(!1),console.log("checkTags error",e)}}))}async function getUserID(e){try{let t=await fetch(`https://helper.donk.workers.dev/twitch/users?login=${e}`,GETrequestOptions);return(await t.json())?.data[0]?.id||""}catch(e){return""}}async function getStreamerColor(e){try{let t=await fetch(`https://helper.donk.workers.dev/twitch/chat/color?user_id=${e}`,GETrequestOptions);return(await t.json())?.data[0]?.color||"#FFFFFF"}catch(e){return console.log("getStreamerColor error",e),"#FFFFFF"}}async function sendUsername(e,t,a,s=null){let o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({site:e,channel:t,platform:a,stream:s}),redirect:"follow"};try{let e=await fetch("https://helper.donk.workers.dev/log/username",o);console.log("sendUsername response",e.status)}catch(e){console.log("sendUsername error",e)}}async function sendData(e,t,a,s,o=null){if(!t)return;let n={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({site:e,channel:t,platform:a,data:s,stream:o}),redirect:"follow"};try{let e=await fetch("https://helper.donk.workers.dev/log/data",n);console.log("sendData response",e.status)}catch(e){console.log("sendData error",e)}}function showConfetti(e){let t,a,s;switch(parseInt(e,10)){case 1:t=100,a=1,s=1e3;break;case 2:t=500,a=2,s=2e3;break;case 3:t=1e3,a=3,s=3e3;break;case 4:t=1e4,a=5,s=5e3;break;default:return}confetti.maxCount=t,confetti.speed=a,confetti.start(s)}async function getChannelBadges(e){return new Promise((async function(t,a){try{let a=await fetch(`https://api.okayeg.com/emotes?channel=${e}`,GETrequestOptions),s=await a.json();s.data.badges&&0!=s.data.badges.length||t({subscriber:[],bits:[]});let o={subscriber:[],bits:[]};if(s.data.badges.length>0){let e=[],a=[];s.data.badges[0]&&("subscriber"==s.data.badges[0].set_id&&(e=s.data.badges[0].versions),"bits"==s.data.badges[0].set_id&&(a=s.data.badges[0].versions)),s.data.badges[1]&&("subscriber"==s.data.badges[1].set_id&&(e=s.data.badges[1].versions),"bits"==s.data.badges[1].set_id&&(a=s.data.badges[1].versions));for(let t=0,a=e.length;t<a;t++)o.subscriber.push({id:e[t].id,url:e[t].image_url_4x});for(let e=0,t=a.length;e<t;e++)o.bits.push({id:a[e].id,url:a[e].image_url_4x});t(o)}}catch(e){console.log("getChannelBadges error",e),t({subscriber:[],bits:[]})}}))}async function getGlobalBadges(){return new Promise((async function(e,t){try{let t=await fetch("https://api.okayeg.com/badges/global",GETrequestOptions),a=await t.json();if(a.data&&0!=a.data.length||e({}),a.data.length>0){let t={};for(let e=0,s=a.data.length;e<s;e++)t[a.data[e].set_id]=a.data[e].versions;e(t)}}catch(t){console.log("getGlobalBadges error",t),e({})}}))}async function getCustomBadges(){return new Promise((async function(e,t){try{let t=await fetch("https://badges.donk.workers.dev",GETrequestOptions),a=await t.json();a&&0!=a.length||e([]),e(a)}catch(t){console.log("getCustomBadges error",t),e([])}}))}async function loadBadges(e){0==Object.keys(globalBadges).length&&(globalBadges=await getGlobalBadges()),0==channelBadges.subscriber.length&&(channelBadges=await getChannelBadges(e)),0==customBadges.length&&(customBadges=await getCustomBadges())}function addBadges(e,t,a){try{let s="";a&&(s+='<i class="material-icons notranslate" style="color:#f18805;" title="First-time chatter">warning_amber</i>');for(let e=0;e<customBadges.length;e++)customBadges[e].users.includes(t)&&customBadges[e].sites.includes("chat.vote")&&(s+=`<img src="${customBadges[e].url}" class="chat-badge" title="${customBadges[e].name}"/>`);if("streamer"==e)return s+='<img src="https://static-cdn.jtvnw.net/badges/v1/5527c58c-fb7d-422d-b71b-f309dcb85cc1/3" class="chat-badge" title="Broadcaster"/>',s;for(const t in e)if("subscriber"==t&&e.subscriber&&channelBadges.subscriber.length>0){s+=`<img src="${channelBadges.subscriber.find((t=>t.id===e.subscriber)).url}" class="chat-badge" title="Subscriber"/>`}else if("bits"==t&&channelBadges.bits.length>0){s+=`<img src="${channelBadges.bits.find((t=>t.id===e.bits)).url}" class="chat-badge" title="Bits"/>`}else if(Object.keys(globalBadges).length>0){s+=`<img src="${globalBadges[t].find((a=>a.id===e[t])).image_url_4x}" class="chat-badge" title="${t}"/>`}return s}catch(e){return console.log(e),""}}function replaceEmotes(e,t){if(e=e.split(" "),0!=t.length)for(let a=0,s=e.length;a<s;a++)for(let s=0,o=t.length;s<o;s++)e[a]==t[s].name&&(t[s].zerowidth?e[a]=`<img title="${t[s].name}" alt="${t[s].name}" src="${t[s].url}" \n            style="height:1.5em; margin-left:${0==a?"0px":"-24px"}">`:e[a]=`<img title="${t[s].name}" alt="${t[s].name}" src="${t[s].url}" style="height:1.5em;">`);return e.join(" ")}function changeSiteLinkTarget(e){let t=document.getElementsByClassName("site-link");for(let a=0;a<t.length;a++)t[a].setAttribute("target",e)}function switchGame(e){switch(e){case"draw":location.href="/games/draw";break;case"arena":location.href="/games/arena";break;case"eb":location.href="/games/emotes";break;case"dh":location.href="/games/donkhunt";break;case"shapes":location.href="/games/shapes";break;case"nim":location.href="/games/nim";break;case"nw":location.href="/games/wordle";break;case"c4":location.href="/games/connect4";break;case"ttt":location.href="/games/tictactoe";break;case"guessr":window.open("https://guessr.tv","_blank").focus();break;case"about":aboutModal.show();break;default:break}}async function getLinkInfo(e,t){if(e.getAttribute("data-bs-title")==spinner){let a=e.getAttribute("href");if(!a)return;a=`LINKPREVIEW${encodeURIComponent(a)}`;let s=bootstrap.Tooltip.getInstance(e);try{let o=await fetch(`https://helper.donk.workers.dev/cors/?${a}`,GETrequestOptions),n=await o.json();if(200!=n?.status&&n?.message)return e.setAttribute("data-bs-title",n.message),void s.setContent({".tooltip-inner":n.message});let r=DOMPurify.sanitize(decodeURIComponent(n.tooltip),{ALLOWED_TAGS:["div","li","br","b","span","hr"]});n.thumbnail&&t&&(r=`<img class="previewThumbnail" src="${n.thumbnail}" alt="link preview thumbnail">`+r),e.setAttribute("data-bs-title",r),s.setContent({".tooltip-inner":r})}catch(t){e.setAttribute("data-bs-title","Could not get link preview :("),s.setContent({".tooltip-inner":"Could not get link preview :("})}}}function linkifyElementID(e,t){linkifyElement(document.getElementById(e),{className:"linktooltip",attributes:{tabindex:"0",rel:"noopener noreferrer",target:"_blank",role:"button","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-container":"body","data-bs-title":spinner},formatHref:{mention:e=>"https://twitch.tv"+e}},document);[...document.querySelectorAll("a.linktooltip")].map((function(e){e.getAttribute("data-bs-title")==spinner&&e.addEventListener("show.bs.tooltip",(function(){getLinkInfo(e,t)}));const a=document.getElementsByClassName("tooltip show");for(;a.length>0;)a[0].parentNode.removeChild(a[0]);return new bootstrap.Tooltip(e,{animation:!1,html:!0,delay:{show:200,hide:0}})}))}function enableTooltips(){[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map((e=>new bootstrap.Tooltip(e)))}function enablePopovers(){[...document.querySelectorAll('[data-bs-toggle="popover"]')].map((e=>new bootstrap.Popover(e)))}async function checkToken(e){let t=new Headers;t.append("Authorization",`OAuth ${e}`);let a={method:"GET",headers:t,redirect:"follow"};return new Promise((async function(e,t){try{let t=await fetch("https://id.twitch.tv/oauth2/validate",a);t.ok||e(!1),(await t.json()).expires_in<600?e(!1):e(!0)}catch(t){console.log("checkToken error",t),e(!1)}}))}function spamTest(e,t,a=100,s=null){let o=[{"badge-info":{subscriber:"30"},badges:{moderator:"1",subscriber:"3030","glhf-pledge":"1"},"badge-info-raw":"subscriber/30","badges-raw":"moderator/1,subscriber/3030,glhf-pledge/1"},{"badge-info":{subscriber:"33"},badges:{moderator:"1",subscriber:"3030","game-developer":"1"},"badge-info-raw":"subscriber/30","badges-raw":"moderator/1,subscriber/3030,game-developer/1"},{"badge-info":null,badges:{moderator:"1"},"badge-info-raw":null,"badges-raw":"moderator/1"},{"badge-info":null,badges:{vip:"1"},"badge-info-raw":null,"badges-raw":"vip/1"},{"badge-info":null,badges:null,"badge-info-raw":null,"badges-raw":null}];for(let n=0;n<t;n++){let t=uuidv4(),n=o[Math.floor(Math.random()*o.length)],r="";switch(e){case"suggest":r=`!suggest  ${uuidv4()}`;break;case"join":r=`!join  ${uuidv4()}`;break;case"vote":if(!s)return'no number of options provided - spamTest("vote", count, number of options)';r=(Math.floor(Math.random()*s)+1).toString();break;default:return'invalid input - spamTest("vote/suggest/join", count, optional max delay in ms, optional number of options for type vote)'}let i={"badge-info":n["badge-info"],badges:n.badges,color:"#"+(16777215*Math.random()<<0).toString(16),"display-name":t,emotes:null,"first-msg":!1,flags:null,id:uuidv4(),mod:!0,"returning-chatter":!1,"room-id":"135944158",subscriber:!0,"tmi-sent-ts":Date.now(),turbo:!1,"user-id":Math.floor(1e9*Math.random()).toString(),"user-type":"mod","emotes-raw":null,"badge-info-raw":n["badge-info-raw"],"badges-raw":n["badges-raw"],username:t,"message-type":"chat"};setTimeout((()=>{client.emit("message","#mwwmwwwwmwwwwwwwmwwwwmwww",i,r,!1)}),Math.random()*a)}}function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)))}