let GETrequestOptions={method:"GET",redirect:"follow"};async function get7TVPFP(t){return t?new Promise((async function(e,a){try{let a=await fetch(`https://7tv.io/v3/users/twitch/${t}`,GETrequestOptions),n=await a.json();e(n?.user?.avatar_url?n.user.avatar_url:"/pics/donk.png")}catch(t){e("/pics/donk.png")}})):"/pics/donk.png"}async function getTwitchPFP(t,e){let a=new Headers;a.append("client-id",CLIENT_ID),a.append("Authorization",`Bearer ${e}`);let n={method:"GET",headers:a,redirect:"follow"};return new Promise((async function(e,a){try{let a=await fetch(`https://api.twitch.tv/helix/users?login=${t}`,n);e((await a.json()).data[0].profile_image_url)}catch(t){e("/pics/donk.png")}}))}async function getGlobalTwitchEmotes(t=!1){let e=[];try{let a=await fetch("https://api.okayeg.com/emotes/global",GETrequestOptions),n=await a.json(),s=["R-)",";-p",";p",";-P",":-p",":p",":-P",";-)",":-\\",":\\",":-/",":-o",":o",":-O","8-)","B-)","o.o","o_o","o.O","o_O","O.O","O_O","O.o",":-Z",":Z",":-z",":z",":-|",":-D",":-(",":-)"];for(let a=0,o=n.data.length;a<o;a++)s.includes(n.data[a].name)||e.push({name:n.data[a].name,url:`https://static-cdn.jtvnw.net/emoticons/v2/${n.data[a].id}/default/dark/${t?"3.0":"1.0"}`});return e}catch(t){return[]}}async function getGlobalBTTVEmotes(t=!1){let e=[],a=["SoSnowy","IceCold","SantaHat","TopHat","ReinDeer","CandyCane","cvMask","cvHazmat"];try{let n=await fetch("https://api.betterttv.net/3/cached/emotes/global",GETrequestOptions),s=await n.json();for(let n=0,o=s.length;n<o;n++)e.push({name:s[n].code,url:`https://cdn.betterttv.net/emote/${s[n].id}/${t?"3x":"1x"}`,zerowidth:a.includes(s[n].code)});return e}catch(t){return[]}}async function getGlobalFFZEmotes(t=!1){let e=[];try{let a=await fetch("https://api.frankerfacez.com/v1/set/global",GETrequestOptions),n=await a.json();for(let a=0;a<n.default_sets.length;a++){let s=n.default_sets[a];for(let a=0,o=n.sets[s].emoticons.length;a<o;a++){let o=n.sets[s].emoticons[a],r=o.urls[t?"4":"1"];o.animated&&(r=o.animated[t?"4":"1"]),e.push({name:o.name,url:r,zerowidth:!1})}}return e}catch(t){return[]}}async function getGlobal7TVEmotes(t=!1){let e=[];try{let a=await fetch("https://7tv.io/v3/emote-sets/global",GETrequestOptions),n=await a.json();for(let a=0,s=n.emotes.length;a<s;a++){let s=n.emotes[a].data.host.files.filter((t=>"AVIF"==t.format));e.push({name:n.emotes[a].name,url:`${n.emotes[a].data.host.url}/${s[t?3:0].name}`,zerowidth:1==n.emotes[a].flags})}return e}catch(t){return[]}}async function getEmoji(){let t=[];try{let e=await fetch("/games/emoji.json",GETrequestOptions),a=await e.json();for(let e=0,n=a.length;e<n;e++)t.push({name:a[e].emoji,desc:a[e].description,url:"emoji"});return t}catch(t){return[]}}async function getChannelTwitchEmotes(t,e=!1){let a=[];try{let n=await fetch(`https://api.okayeg.com/emotes?channel=${t}`,GETrequestOptions),s=await n.json();if(s.data.id&&s.data.emotes.length>0){for(let t=0,n=s.data.emotes.length;t<n;t++)a.push({name:s.data.emotes[t].name,url:`https://static-cdn.jtvnw.net/emoticons/v2/${s.data.emotes[t].id}/default/dark/${e?"3.0":"1.0"}`});return a}}catch(t){return[]}}async function getChannelBTTVEmotes(t,e=!1){if(!t)return[];let a=[];try{let n=await fetch(`https://api.betterttv.net/3/cached/users/twitch/${t}`,GETrequestOptions),s=await n.json();if(200==n.status&&"user not found"!=s?.message){for(let t=0,n=s.channelEmotes.length;t<n;t++)a.push({name:s.channelEmotes[t].code,url:`https://cdn.betterttv.net/emote/${s.channelEmotes[t].id}/${e?"3x":"1x"}`,zerowidth:!1});for(let t=0,n=s.sharedEmotes.length;t<n;t++)a.push({name:s.sharedEmotes[t].code,url:`https://cdn.betterttv.net/emote/${s.sharedEmotes[t].id}/${e?"3x":"1x"}`,zerowidth:!1});return a}return[]}catch(t){return[]}}async function getChannelFFZEmotes(t,e=!1){let a=[];try{let n=await fetch(`https://api.frankerfacez.com/v1/room/id/${t}`,GETrequestOptions),s=await n.json();if(404!=s.status){let t=s.room.set,n=s.sets[t];for(let t=0,s=n.emoticons.length;t<s;t++){let s=n.emoticons[t].urls[e?"4":"1"];n.emoticons[t].animated&&(s=n.emoticons[t].animated[e?"4":"1"]),a.push({name:n.emoticons[t].name,url:s,zerowidth:!1})}return a}}catch(t){return[]}}async function getChannel7TVEmotes(t,e=!1){if(!t)return[];let a=[];try{let n=await fetch(`https://7tv.io/v3/users/twitch/${t}`,GETrequestOptions),s=await n.json();for(let t=0,n=s.emote_set.emotes.length;t<n;t++){let n=s.emote_set.emotes[t].data.host.files.filter((t=>"AVIF"==t.format));a.push({name:s.emote_set.emotes[t].name,url:`${s.emote_set.emotes[t].data.host.url}/${n[e?3:0].name}`,zerowidth:1==s.emote_set.emotes[t].flags})}return a}catch(t){return[]}}function showToast(t,e,a){let n=Date.now(),s=`<div id="${n}" class="toast align-items-center text-bg-${e} border-0" role="alert" data-bs-autohide="false" aria-live="assertive" aria-atomic="true">\n      <div class="d-flex">\n      <div class="toast-body" style="font-size:1.2em">${t}</div>\n      <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>\n      </div>\n      </div>`;elements.toastContainer.innerHTML+=s;let o=[].slice.call(document.querySelectorAll(".toast")).map((function(t){return new bootstrap.Toast(t,{animation:!1,autohide:!1})}));o[o.length-1].show(),setTimeout((function(){o[o.length-1].hide(),document.getElementById(n).remove()}),a)}async function checkTags(t,e){if(!e||!t)return!1;let a=new Headers;a.append("client-id",CLIENT_ID),a.append("Authorization",`Bearer ${e}`);let n={method:"GET",headers:a,redirect:"follow"};return new Promise((async function(e,a){try{let a=await fetch(`https://api.twitch.tv/helix/channels?broadcaster_id=${t}`,n),s=await a.json();if(!s.data[0].tags||0==s.data[0].tags.length)return;let o=["브이튜버","pngtuber","버튜버","버츄얼","vstreamer","ｖtuber","live2d"];for(let t=0;t<s.data[0].tags.length;t++){let a=s.data[0].tags[t].toLowerCase();a.includes("vtube")&&e(!0),o.includes(a)&&e(!0)}e(!1)}catch(t){e(!1)}}))}async function getUserID(t){try{let e=await fetch(`https://helper.pepega.workers.dev/twitch/users?login=${t}`,GETrequestOptions);return(await e.json())?.data[0]?.id||""}catch(t){return""}}async function sendUsername(t,e,a,n=null){let s={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({site:t,channel:e,platform:a,stream:n}),redirect:"follow"};try{await fetch("https://helper.pepega.workers.dev/log/username",s)}catch(t){}}async function sendData(t,e,a,n,s=null){if(!e)return;let o={method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({site:t,channel:e,platform:a,data:n,stream:s}),redirect:"follow"};try{await fetch("https://helper.pepega.workers.dev/log/data",o)}catch(t){}}function showConfetti(t){let e,a,n;switch(parseInt(t,10)){case 1:e=100,a=1,n=1e3;break;case 2:e=500,a=2,n=2e3;break;case 3:e=1e3,a=3,n=3e3;break;case 4:e=1e4,a=5,n=5e3;break;default:return}confetti.maxCount=e,confetti.speed=a,confetti.start(n)}async function getChannelBadges(t){return new Promise((async function(e,a){try{let a=await fetch(`https://api.okayeg.com/emotes?channel=${t}`,GETrequestOptions),n=await a.json();n.data.badges&&0!=n.data.badges.length||e({subscriber:[],bits:[]});let s={subscriber:[],bits:[]};if(n.data.badges.length>0){let t=[],a=[];n.data.badges[0]&&("subscriber"==n.data.badges[0].set_id&&(t=n.data.badges[0].versions),"bits"==n.data.badges[0].set_id&&(a=n.data.badges[0].versions)),n.data.badges[1]&&("subscriber"==n.data.badges[1].set_id&&(t=n.data.badges[1].versions),"bits"==n.data.badges[1].set_id&&(a=n.data.badges[1].versions));for(let e=0,a=t.length;e<a;e++)s.subscriber.push({id:t[e].id,url:t[e].image_url_4x});for(let t=0,e=a.length;t<e;t++)s.bits.push({id:a[t].id,url:a[t].image_url_4x});e(s)}}catch(t){e({subscriber:[],bits:[]})}}))}async function getGlobalBadges(){return new Promise((async function(t,e){try{let e=await fetch("https://api.okayeg.com/badges/global",GETrequestOptions),a=await e.json();if(a.data&&0!=a.data.length||t({}),a.data.length>0){let e={};for(let t=0,n=a.data.length;t<n;t++)e[a.data[t].set_id]=a.data[t].versions;t(e)}}catch(e){t({})}}))}async function getCustomBadges(){return new Promise((async function(t,e){try{let e=await fetch("https://badges.pepega.workers.dev",GETrequestOptions),a=await e.json();a&&0!=a.length||t([]),t(a)}catch(e){t([])}}))}function replaceEmotes(t,e){if(t=t.split(" "),0!=e.length)for(let a=0,n=t.length;a<n;a++)for(let n=0,s=e.length;n<s;n++)t[a]==e[n].name&&(e[n].zerowidth?t[a]=`<img title="${e[n].name}" alt="${e[n].name}" src="${e[n].url}" \n            style="height:1.5em; margin-left:${0==a?"0px":"-24px"}">`:t[a]=`<img title="${e[n].name}" alt="${e[n].name}" src="${e[n].url}" style="height:1.5em;">`);return t.join(" ")}function changeSiteLinkTarget(t){let e=document.getElementsByClassName("site-link");for(let a=0;a<e.length;a++)e[a].setAttribute("target",t)}function switchGame(t){switch(t){case"draw":location.href="/games/draw";break;case"arena":location.href="/games/arena";break;case"eb":location.href="/games/emotes";break;case"dh":location.href="/games/donkhunt";break;case"shapes":location.href="/games/shapes";break;case"nim":location.href="/games/nim";break;case"nw":location.href="/games/wordle";break;case"c4":location.href="/games/connect4";break;case"ttt":location.href="/games/tictactoe";break;case"guessr":window.open("https://guessr.tv","_blank").focus();break;case"about":aboutModal.show();break;default:break}}async function getLinkInfo(t,e){if(t.getAttribute("data-bs-title")==spinner){let a=t.getAttribute("href");if(!a)return;a=`LINKPREVIEW${encodeURIComponent(a)}`;let n=bootstrap.Tooltip.getInstance(t);try{let s=await fetch(`https://helper.pepega.workers.dev/cors/?${a}`,GETrequestOptions),o=await s.json();if(200!=o?.status&&o?.message)return t.setAttribute("data-bs-title",o.message),void n.setContent({".tooltip-inner":o.message});let r=DOMPurify.sanitize(decodeURIComponent(o.tooltip),{ALLOWED_TAGS:["div","li","br","b","span","hr"]});o.thumbnail&&e&&(r=`<img class="previewThumbnail" src="${o.thumbnail}" alt="link preview thumbnail">`+r),t.setAttribute("data-bs-title",r),n.setContent({".tooltip-inner":r})}catch(e){t.setAttribute("data-bs-title","Could not get link preview :("),n.setContent({".tooltip-inner":"Could not get link preview :("})}}}function linkifyElementID(t,e){linkifyElement(document.getElementById(t),{className:"linktooltip",attributes:{tabindex:"0",rel:"noopener noreferrer",target:"_blank",role:"button","data-bs-toggle":"tooltip","data-bs-placement":"top","data-bs-container":"body","data-bs-title":spinner},formatHref:{mention:t=>"https://twitch.tv"+t}},document);[...document.querySelectorAll("a.linktooltip")].map((function(t){t.getAttribute("data-bs-title")==spinner&&t.addEventListener("show.bs.tooltip",(function(){getLinkInfo(t,e)}));const a=document.getElementsByClassName("tooltip show");for(;a.length>0;)a[0].parentNode.removeChild(a[0]);return new bootstrap.Tooltip(t,{animation:!1,html:!0,delay:{show:200,hide:0}})}))}function enableTooltips(){[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map((t=>new bootstrap.Tooltip(t)))}function enablePopovers(){[...document.querySelectorAll('[data-bs-toggle="popover"]')].map((t=>new bootstrap.Popover(t)))}async function checkToken(t){let e=new Headers;e.append("Authorization",`OAuth ${t}`);let a={method:"GET",headers:e,redirect:"follow"};return new Promise((async function(t,e){try{let e=await fetch("https://id.twitch.tv/oauth2/validate",a);e.ok||t(!1),(await e.json()).expires_in<600?t(!1):t(!0)}catch(e){t(!1)}}))}function spamTest(t,e){for(let a=0;a<e;a++){let e=uuidv4(),a={"badge-info":{subscriber:"30"},badges:{moderator:"1",subscriber:"3030","glhf-pledge":"1"},color:"#"+(16777215*Math.random()<<0).toString(16),"display-name":e,emotes:null,"first-msg":!1,flags:null,id:uuidv4(),mod:!0,"returning-chatter":!1,"room-id":"135944158",subscriber:!0,"tmi-sent-ts":Date.now(),turbo:!1,"user-id":Math.floor(1e9*Math.random()).toString(),"user-type":"mod","emotes-raw":null,"badge-info-raw":"subscriber/30","badges-raw":"moderator/1,subscriber/3030,glhf-pledge/1",username:e,"message-type":"chat"};setTimeout((()=>{client.emit("message","#mwwmwwwwmwwwwwwwmwwwwmwww",a,t,!1)}),100)}}function uuidv4(){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16)))}