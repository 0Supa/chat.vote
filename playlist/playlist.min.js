let client,loginButton,settingsOffcanvas,loginExpiredModal,resetSettingsModal,copyLinkButton,queueTab,approvalTab,historyTab,oldSliderValue,elements={loginExpiredModal:document.getElementById("loginExpiredModal"),resetSettingsModal:document.getElementById("resetSettingsModal"),vtsLink:document.getElementById("vtsLink"),status:document.getElementById("status"),topRight:document.getElementById("topRight"),loginButton:document.getElementById("loginButton"),channelName:document.getElementById("channelName"),darkTheme:document.getElementById("darkTheme"),settingsOffcanvas:document.getElementById("settingsOffcanvas"),allowSpotifySongs:document.getElementById("allowSpotifySongs"),allowTwitchClips:document.getElementById("allowTwitchClips"),allowTwitchStreams:document.getElementById("allowTwitchStreams"),allowTwitchVODs:document.getElementById("allowTwitchVODs"),allowYTStreams:document.getElementById("allowYTStreams"),allowYTShorts:document.getElementById("allowYTShorts"),allowYTVideos:document.getElementById("allowYTVideos"),maxDuration:document.getElementById("maxDuration"),maxDurationUnit:document.getElementById("maxDurationUnit"),maxLength:document.getElementById("maxLength"),maxSize:document.getElementById("maxSize"),whoCanRequest:document.getElementById("whoCanRequest"),allowPlebs:document.getElementById("allowPlebs"),allowSubs:document.getElementById("allowSubs"),allowMods:document.getElementById("allowMods"),allowVips:document.getElementById("allowVips"),allowFirstTimeChatters:document.getElementById("allowFirstTimeChatters"),plebLimit:document.getElementById("plebLimit"),subLimit:document.getElementById("subLimit"),modLimit:document.getElementById("modLimit"),vipLimit:document.getElementById("vipLimit"),firstTimeChatterLimit:document.getElementById("firstTimeChatterLimit"),selectAll:document.getElementById("selectAll"),unselectAll:document.getElementById("unselectAll"),noCommand:document.getElementById("noCommand"),requestCommand:document.getElementById("requestCommand"),requestCommandAlias:document.getElementById("requestCommandAlias"),allowVoteSkip:document.getElementById("allowVoteSkip"),voteskipCommand:document.getElementById("voteskipCommand"),voteskipCommandAlias:document.getElementById("voteskipCommandAlias"),voteskipCount:document.getElementById("voteskipCount"),enableBot:document.getElementById("enableBot"),botCooldown:document.getElementById("botCooldown"),songCommand:document.getElementById("songCommand"),songCommandAlias:document.getElementById("songCommandAlias"),queueCommand:document.getElementById("queueCommand"),queueCommandAlias:document.getElementById("queueCommandAlias"),approvalQueue:document.getElementById("approvalQueue"),skipCommand:document.getElementById("skipCommand"),modSkip:document.getElementById("modSkip"),minViewCount:document.getElementById("minViewCount"),toastContainer:document.getElementById("toastContainer"),playersCard:document.getElementById("playersCard"),commandHint:document.getElementById("commandHint"),toggleQueue:document.getElementById("toggleQueue"),toggleQueueLabel:document.getElementById("toggleQueueLabel"),resetQueue:document.getElementById("resetQueue"),link:document.getElementById("link"),addLink:document.getElementById("addLink"),queue:document.getElementById("queue"),queueTab:document.getElementById("queueTab"),approvalTabButton:document.getElementById("approvalTabButton"),approvalTab:document.getElementById("approvalTab"),queueList:document.getElementById("queueList"),approvalList:document.getElementById("approvalList"),historyTab:document.getElementById("historyTab"),historyList:document.getElementById("historyList"),profileLink:document.getElementById("profileLink"),copyLinkButton:document.getElementById("copyLinkButton"),volumeSliderIcon:document.getElementById("volumeSliderIcon"),volumeSlider:document.getElementById("volumeSlider"),volumeSliderValue:document.getElementById("volumeSliderValue")},color="",currentTime=0,queue_open=!1,USER={channel:"",twitchLogin:!1,access_token:"",userID:"",platform:""},QUEUE={allowSpotifySongs:!0,allowTwitchClips:!0,allowTwitchStreams:!0,allowTwitchVODs:!0,allowYTStreams:!0,allowYTShorts:!0,allowYTVideos:!0,maxDuration:"",maxDurationUnit:"m",maxLength:"",maxSize:"",allowPlebs:!0,allowSubs:!0,allowMods:!0,allowVips:!0,allowFirstTimeChatters:!0,plebLimit:1,subLimit:1,modLimit:1,vipLimit:1,firstTimeChatterLimit:1,noCommand:!1,requestCommand:"!request",requestCommandAlias:"!r",allowVoteSkip:!1,voteskipCommand:"!voteskip",voteskipCommandAlias:"!vs",voteskipCount:1,enableBot:!1,botCooldown:1,songCommand:"!song",songCommandAlias:"!s",queueCommand:"!queue",queueCommandAlias:"!q",approvalQueue:!1,skipCommand:"!skip",modSkip:!1,minViewCount:""};async function refreshData(){darkTheme=elements.darkTheme.checked??!0,USER.twitchLogin||(USER.channel=validator.escape(elements.channelName.value.replace(/\s+/g,"").toLowerCase()),USER.platform="twitch"),!USER.userID&&USER.channel&&(USER.userID=await getUserID(USER.channel)),QUEUE.allowSpotifySongs=elements.allowSpotifySongs.checked,QUEUE.allowTwitchClips=elements.allowTwitchClips.checked,QUEUE.allowTwitchStreams=elements.allowTwitchStreams.checked,QUEUE.allowTwitchVODs=elements.allowTwitchVODs.checked,QUEUE.allowYTStreams=elements.allowYTStreams.checked,QUEUE.allowYTShorts=elements.allowYTShorts.checked,QUEUE.allowYTVideos=elements.allowYTVideos.checked,QUEUE.maxDuration=parseInt(elements.maxDuration.value,10)||"",QUEUE.maxDurationUnit=elements.maxDurationUnit.value||"m",QUEUE.maxLength=parseInt(elements.maxLength.value,10)||"",QUEUE.maxSize=parseInt(elements.maxSize.value,10)||"",QUEUE.allowPlebs=elements.allowPlebs.checked,QUEUE.allowSubs=elements.allowSubs.checked,QUEUE.allowMods=elements.allowMods.checked,QUEUE.allowVips=elements.allowVips.checked,QUEUE.allowFirstTimeChatters=elements.allowFirstTimeChatters.checked,QUEUE.plebLimit=parseInt(elements.plebLimit.value,10)||1,QUEUE.subLimit=parseInt(elements.subLimit.value,10)||1,QUEUE.modLimit=parseInt(elements.modLimit.value,10)||1,QUEUE.vipLimit=parseInt(elements.vipLimit.value,10)||1,QUEUE.firstTimeChatterLimit=parseInt(elements.firstTimeChatterLimit.value,10)||1,QUEUE.noCommand=elements.noCommand.checked,QUEUE.requestCommand=elements.requestCommand.value.replace(/\s+/g,"").toLowerCase()||"!request",QUEUE.requestCommandAlias=elements.requestCommandAlias.value.replace(/\s+/g,"").toLowerCase()||"!r",QUEUE.allowVoteSkip=elements.allowVoteSkip.checked,QUEUE.voteskipCommand=elements.voteskipCommand.value.replace(/\s+/g,"").toLowerCase()||"!voteskip",QUEUE.voteskipCommandAlias=elements.voteskipCommandAlias.value.replace(/\s+/g,"").toLowerCase()||"!vs",QUEUE.voteskipCount=parseInt(elements.voteskipCount.value,10)||1,QUEUE.enableBot=elements.enableBot.checked,QUEUE.botCooldown=parseInt(elements.botCooldown.value,10)||1,QUEUE.songCommand=elements.songCommand.value.replace(/\s+/g,"").toLowerCase()||"!song",QUEUE.songCommandAlias=elements.songCommandAlias.value.replace(/\s+/g,"").toLowerCase()||"!s",QUEUE.queueCommand=elements.queueCommand.value.replace(/\s+/g,"").toLowerCase()||"!queue",QUEUE.queueCommandAlias=elements.queueCommandAlias.value.replace(/\s+/g,"").toLowerCase()||"!q",QUEUE.approvalQueue=elements.approvalQueue.checked,QUEUE.skipCommand=elements.skipCommand.value.replace(/\s+/g,"").toLowerCase()||"!skip",QUEUE.modSkip=elements.modSkip.checked,QUEUE.minViewCount=parseInt(elements.minViewCount.value,10)||"",elements.voteskipCommand.disabled=!QUEUE.allowVoteSkip,elements.voteskipCommandAlias.disabled=!QUEUE.allowVoteSkip,elements.voteskipCount.disabled=!QUEUE.allowVoteSkip,elements.botCooldown.disabled=!QUEUE.enableBot,elements.songCommand.disabled=!QUEUE.enableBot,elements.songCommandAlias.disabled=!QUEUE.enableBot,elements.queueCommand.disabled=!QUEUE.enableBot,elements.queueCommandAlias.disabled=!QUEUE.enableBot,elements.approvalTabButton.style.display=QUEUE.approvalQueue?"":"none",QUEUE.noCommand?elements.commandHint.innerHTML="Add songs or videos to the queue by posting a link in chat":elements.commandHint.innerHTML=`Add songs or videos to the queue using \n    <kbd class="notranslate text-success cursor-pointer" onclick="editRequestCommand()">${QUEUE.requestCommand}</kbd> or \n    <kbd class="notranslate text-success cursor-pointer" onclick="editRequestCommand(true)">${QUEUE.requestCommandAlias}</kbd>`,updateWhoCanRequest(),checkCommands()}function saveSettings(){refreshData(),localStorage.setItem("USER",JSON.stringify(USER)),localStorage.setItem("QUEUE",JSON.stringify(QUEUE)),localStorage.setItem("darkTheme",darkTheme)}function load_localStorage(){localStorage.getItem("USER")?(USER=JSON.parse(localStorage.getItem("USER")),elements.channelName.value=USER.channel):console.log("localStorage user info not found"),localStorage.getItem("QUEUE")?(QUEUE=JSON.parse(localStorage.getItem("QUEUE")),elements.allowSpotifySongs.checked=QUEUE.allowSpotifySongs??!0,elements.allowTwitchClips.checked=QUEUE.allowTwitchClips??!0,elements.allowTwitchStreams.checked=QUEUE.allowTwitchStreams??!0,elements.allowTwitchVODs.checked=QUEUE.allowTwitchVODs??!0,elements.allowYTStreams.checked=QUEUE.allowYTStreams??!0,elements.allowYTShorts.checked=QUEUE.allowYTShorts??!0,elements.allowYTVideos.checked=QUEUE.allowYTVideos??!0,elements.maxDuration.value=QUEUE.maxDuration||"",elements.maxDurationUnit.value=QUEUE.maxDurationUnit||"m",elements.maxLength.value=QUEUE.maxLength||"",elements.maxSize.value=QUEUE.maxSize||"",elements.allowPlebs.checked=QUEUE.allowPlebs??!0,elements.allowSubs.checked=QUEUE.allowSubs??!0,elements.allowMods.checked=QUEUE.allowMods??!0,elements.allowVips.checked=QUEUE.allowVips??!0,elements.allowFirstTimeChatters.checked=QUEUE.allowFirstTimeChatters??!0,elements.plebLimit.value=QUEUE.plebLimit||1,elements.subLimit.value=QUEUE.subLimit||1,elements.modLimit.value=QUEUE.modLimit||1,elements.vipLimit.value=QUEUE.vipLimit||1,elements.firstTimeChatterLimit.value=QUEUE.firstTimeChatterLimit||1,elements.noCommand.checked=QUEUE.noCommand??!1,elements.requestCommand.value=QUEUE.requestCommand||"!request",elements.requestCommandAlias.value=QUEUE.requestCommandAlias||"!r",elements.allowVoteSkip.checked=QUEUE.allowVoteSkip??!1,elements.voteskipCommand.value=QUEUE.voteskipCommand||"!voteskip",elements.voteskipCommandAlias.value=QUEUE.voteskipCommandAlias||"!vs",elements.voteskipCount.value=QUEUE.voteskipCount||1,elements.enableBot.checked=QUEUE.enableBot??!1,elements.botCooldown.value=QUEUE.botCooldown||1,elements.songCommand.value=QUEUE.songCommand||"!song",elements.songCommandAlias.value=QUEUE.songCommandAlias||"!s",elements.queueCommand.value=QUEUE.queueCommand||"!queue",elements.queueCommandAlias.value=QUEUE.queueCommandAlias||"!q",elements.approvalQueue.checked=QUEUE.approvalQueue??!1,elements.skipCommand.value=QUEUE.skipCommand||"!skip",elements.modSkip.checked=QUEUE.modSkip??!1,elements.minViewCount.value=QUEUE.minViewCount||"",elements.voteskipCommand.disabled=!QUEUE.allowVoteSkip,elements.voteskipCommandAlias.disabled=!QUEUE.allowVoteSkip,elements.voteskipCount.disabled=!QUEUE.allowVoteSkip,elements.botCooldown.disabled=!QUEUE.enableBot,elements.songCommand.disabled=!QUEUE.enableBot,elements.songCommandAlias.disabled=!QUEUE.enableBot,elements.queueCommand.disabled=!QUEUE.enableBot,elements.queueCommandAlias.disabled=!QUEUE.enableBot,elements.approvalTabButton.style.display=QUEUE.approvalQueue?"":"none",QUEUE.noCommand?elements.commandHint.innerHTML="Add songs or videos to the queue by posting a link in chat":elements.commandHint.innerHTML=`Add songs or videos to the queue using \n      <kbd class="notranslate text-success cursor-pointer" onclick="editRequestCommand()">${QUEUE.requestCommand}</kbd> or \n      <kbd class="notranslate text-success cursor-pointer" onclick="editRequestCommand(true)">${QUEUE.requestCommandAlias}</kbd>`,updateWhoCanRequest(),checkCommands()):console.log("localStorage settings not found")}function resetSettings(e=!1){return e&&localStorage.setItem("USER",JSON.stringify({channel:"",twitchLogin:!1,access_token:"",userID:"",platform:""})),localStorage.setItem("QUEUE",JSON.stringify({allowSpotifySongs:!0,allowTwitchClips:!0,allowTwitchStreams:!0,allowTwitchVODs:!0,allowYTStreams:!0,allowYTShorts:!0,allowYTVideos:!0,maxDuration:"",maxDurationUnit:"m",maxLength:"",maxSize:"",allowPlebs:!0,allowSubs:!0,allowMods:!0,allowVips:!0,allowFirstTimeChatters:!0,plebLimit:1,subLimit:1,modLimit:1,vipLimit:1,firstTimeChatterLimit:1,noCommand:!1,requestCommand:"!request",requestCommandAlias:"!r",allowVoteSkip:!1,voteskipCommand:"!voteskip",voteskipCommandAlias:"!vs",voteskipCount:1,enableBot:!1,botCooldown:1,songCommand:"!song",songCommandAlias:"!s",queueCommand:"!queue",queueCommandAlias:"!q",approvalQueue:!1,skipCommand:"!skip",modSkip:!1,minViewCount:""})),location.reload(),!1}function login(){return elements.topRight.innerHTML='<div class="btn-group" role="group" aria-label="log in button group">\n    <button type="button" class="btn btn-twitch"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></button>\n    <div class="btn-group" role="group">\n        <button id="btnGroupDropLogin" type="button" class="btn btn-twitch dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">\n      </button>\n        <ul class="dropdown-menu dropdown-menu-lg-end" aria-label="Log out">\n            <li><a class="dropdown-item" onclick="logout()" href="#"><i class="material-icons notranslate">logout</i>Log out</a></li>\n        </ul>\n    </div>\n</div>',window.open("/prompt.html","loginWindow","toolbar=0,status=0,scrollbars=0,width=500px,height=800px"),!1}function connect(){elements.status.innerHTML='\n  <h4>\n  <span class="badge bg-warning">Connecting... \n  <div class="spinner-border" style="width:18px;height:18px;" role="status"><span class="visually-hidden">Loading...</span></div>\n  </span>\n  </h4>',elements.topRight.innerHTML='\n  <div class="btn-group" role="group" aria-label="log in button group">\n  <button type="button" class="btn btn-twitch"><div class="spinner-border" role="status"><span class="visually-hidden">Loading...</span></div></button>\n  <div class="btn-group" role="group">\n  <button id="btnGroupDropLogin" type="button" class="btn btn-twitch dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false"></button>\n  <ul class="dropdown-menu dropdown-menu-lg-end" aria-label="Log out">\n  <li><a class="dropdown-item" onclick="logout()" href="#"><i class="material-icons notranslate">logout</i>Log out</a></li>\n  </ul>\n  </div>\n  </div>',refreshData(),loadBadges(USER.channel);let e={options:{clientId:CLIENT_ID,debug:!1},connection:{secure:!0,reconnect:!0},channels:[USER.channel]};client=new tmi.client(e),client.on("message",(async(e,t,n,o)=>{let l=n.split(" ").filter(Boolean);l[0].toLowerCase(),l.slice(1)})),client.on("timeout",((e,t,n,o,l)=>{})),client.on("connected",(async(e,t)=>{console.log(`Connected to ${e}:${t}`),elements.status.innerHTML='<h4><span class="badge bg-success">Connected :)</span></h4>',saveSettings(),sendUsername("chat.vote/playlist",USER.channel,"twitch"==USER.platform?`twitch - ${USER.twitchLogin}`:"youtube"),await checkTags(USER.userID,USER.access_token)&&(elements.vtsLink.style.display=""),loadPFP()})),client.on("disconnected",(e=>{elements.status.innerHTML=`<h4><span class="badge bg-danger">Disconnected: ${e}</span></h4>`})),client.on("notice",((e,t,n)=>{elements.status.innerHTML=`<h4><span class="badge bg-danger">Disconnected: ${n}</span></h4>`})),client.connect().catch(console.error)}async function loadPFP(){if(!USER.channel)return void(elements.topRight.innerHTML=' <div class="btn-group" role="group" aria-label="login options">\n    <a\n      role="button"\n      id="loginButton"\n      onclick="login()"\n      class="btn btn-twitch"\n      tabindex="0"\n      data-bs-container="body"\n      data-bs-custom-class="custom-popover"\n      data-bs-placement="bottom"\n      data-bs-trigger="manual"\n      data-bs-toggle="popover"\n      data-bs-title="Not signed in"\n      data-bs-content="You need sign in first before adding options or enabling voting/suggestions"\n      ><span class="twitch-icon"></span>Sign in with Twitch</a\n    >\n    <div class="btn-group" role="group">\n      <button\n        id="btnGroupDropLogin"\n        type="button"\n        class="btn btn-twitch dropdown-toggle"\n        data-bs-toggle="dropdown"\n        data-bs-auto-close="outside"\n        aria-label="other login option, connect manually"\n        aria-expanded="false"\n      ></button>\n      <div class="dropdown-menu dropdown-menu-end" aria-labelledby="btnGroupDropLogin">\n        <div class="p-3" style="width: 300px">\n          <label for="channelName" class="form-label">Connect to chat directly</label>\n          <div class="input-group mb-3">\n            <span class="input-group-text" id="directLoginChannel">twitch.tv/</span>\n            <input type="text" class="form-control" id="channelName" aria-describedby="directLoginChannel" />\n          </div>\n          <small class="text-body-secondary">Some features will not be available if you connect directly</small><br />\n          <button type="button" onclick="connect()" class="btn btn-primary float-end">Connect</button>\n        </div>\n      </div>\n    </div>\n  </div>');let e=await get7TVPFP(USER.userID);"/pics/donk.png"==e&&USER.access_token&&(e=await getTwitchPFP(USER.channel,USER.access_token)),elements.topRight.innerHTML=`\n  <div class="btn-group" role="group" aria-label="Button group with nested dropdown">\n  <button type="button" id="btnGroupDrop2" class="btn btn-${darkTheme?"dark":"secondary"}"><img src="${e}" alt="profile pic" style="height:2em;"></button>\n  <div class="btn-group" role="group">\n  <button id="btnGroupDrop1" type="button" class="btn btn-${darkTheme?"dark":"secondary"} dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">\n  ${USER.channel}\n  </button>\n  <ul class="dropdown-menu dropdown-menu-lg-end" aria-labelledby="btnGroupDrop1">\n  <li><a class="dropdown-item" onclick="logout()" href="#"><i class="material-icons notranslate">logout</i>Log out</a></li>\n  </ul>\n  </div>\n  </div>`}function checkLogin(){return!!USER.channel||(loginButton.show(),setTimeout((function(){loginButton.hide()}),4e3),!1)}function logout(){elements.topRight.innerHTML=' <div class="btn-group" role="group" aria-label="login options">\n  <a\n    role="button"\n    id="loginButton"\n    onclick="login()"\n    class="btn btn-twitch"\n    tabindex="0"\n    data-bs-container="body"\n    data-bs-custom-class="custom-popover"\n    data-bs-placement="bottom"\n    data-bs-trigger="manual"\n    data-bs-toggle="popover"\n    data-bs-title="Not signed in"\n    data-bs-content="You need sign in first before adding options or enabling voting/suggestions"\n    ><span class="twitch-icon"></span>Sign in with Twitch</a\n  >\n  <div class="btn-group" role="group">\n    <button\n      id="btnGroupDropLogin"\n      type="button"\n      class="btn btn-twitch dropdown-toggle"\n      data-bs-toggle="dropdown"\n      data-bs-auto-close="outside"\n      aria-label="other login option, connect manually"\n      aria-expanded="false"\n    ></button>\n    <div class="dropdown-menu dropdown-menu-end" aria-labelledby="btnGroupDropLogin">\n      <div class="p-3" style="width: 300px">\n        <label for="channelName" class="form-label">Connect to chat directly</label>\n        <div class="input-group mb-3">\n          <span class="input-group-text" id="directLoginChannel">twitch.tv/</span>\n          <input type="text" class="form-control" id="channelName" aria-describedby="directLoginChannel" />\n        </div>\n        <small class="text-body-secondary">Some features will not be available if you connect directly</small><br />\n        <button type="button" onclick="connect()" class="btn btn-primary float-end">Connect</button>\n      </div>\n    </div>\n  </div>\n</div>',resetSettings(!0)}async function loadAndConnect(){load_localStorage(),refreshData();const e=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)});if(e.channel&&!USER.channel&&!USER.twitchLogin&&!USER.access_token&&!USER.userID){let t=e.channel.replace(/\s+/g,"").toLowerCase();elements.channelName.value=t,USER.channel=t,window.history.replaceState({},document.title,"/")}if(USER.twitchLogin&&!await checkToken(USER.access_token))return USER.channel="",void loginExpiredModal.show();USER.channel&&(connect(),elements.profileLink.value=`https://playlist.chat.vote/${USER.channel||""}`)}function copyLink(){navigator.clipboard.writeText(`https://playlist.chat.vote/${USER.channel||""}`),copyLinkButton.show(),setTimeout((()=>{copyLinkButton.hide()}),1e3)}function switchTheme(e){document.documentElement.setAttribute("data-bs-theme",e?"dark":"light"),document.getElementById("twitchLogo").style.filter=`invert(${e?.25:.65})`,document.getElementById("btnGroupDrop1")&&document.getElementById("btnGroupDrop2")&&(document.getElementById("btnGroupDrop1").classList.remove(""+(e?"btn-secondary":"btn-dark")),document.getElementById("btnGroupDrop1").classList.add(""+(e?"btn-dark":"btn-secondary")),document.getElementById("btnGroupDrop2").classList.remove(""+(e?"btn-secondary":"btn-dark")),document.getElementById("btnGroupDrop2").classList.add(""+(e?"btn-dark":"btn-secondary")))}function toggleEveryone(e){elements.allowPlebs.checked=e,elements.allowSubs.checked=e,elements.allowMods.checked=e,elements.allowVips.checked=e,elements.allowFirstTimeChatters.checked=e}function updateWhoCanRequest(){let e={"Non subscribers":{allowed:QUEUE.allowPlebs,limit:QUEUE.plebLimit},Subscribers:{allowed:QUEUE.allowSubs,limit:QUEUE.subLimit},Mods:{allowed:QUEUE.allowMods,limit:QUEUE.modLimit},VIPs:{allowed:QUEUE.allowVips,limit:QUEUE.vipLimit},"First time chatters":{allowed:QUEUE.allowFirstTimeChatters,limit:QUEUE.firstTimeChatterLimit}},t=[],n=[],o=0;for(let[l,a]of Object.entries(e))a.allowed&&(t.push(l),n.push(`${l} can make ${a.limit} ${1==a.limit?"request":"requests"}`),o+=a.limit-1);0!=t.length?elements.whoCanRequest.innerHTML=`${1==t.length?"Only":""} ${5==t.length?"Everyone":t.join(", ")} will be able to request.<br>\n  ${0==o?"Everyone will get 1 request.":n.join(" - ")}`:elements.whoCanRequest.innerHTML='<span class="text-danger">No one will be able to request</span>'}function checkCommands(){let e=[elements.requestCommand,elements.requestCommandAlias,elements.voteskipCommand,elements.voteskipCommandAlias,elements.songCommand,elements.songCommandAlias,elements.queueCommand,elements.queueCommandAlias,elements.skipCommand],t=e.map((e=>e.value.replace(/\s+/g,"").toLowerCase())),n=t.filter(((e,n)=>t.indexOf(e.replace(/\s+/g,"").toLowerCase())!==n)),o=e.filter((e=>n.includes(e.value.replace(/\s+/g,"").toLowerCase()))),l=!1;for(let e=0;e<o.length;e++)o[e].value=o[e].dataset.default,QUEUE[o[e].id]=o[e].dataset.default,l=!0;l&&showToast("Commands must be unique","warning",2e3)}function editRequestCommand(e=!1){settingsOffcanvas.show(),setTimeout((()=>{e?(elements.requestCommandAlias.focus(),elements.requestCommandAlias.select()):(elements.requestCommand.focus(),elements.requestCommand.select())}),500)}function toggleMute(){"volume_off"==elements.volumeSliderIcon.innerHTML?(0==oldSliderValue&&(elements.volumeSliderIcon.innerHTML="volume_mute"),oldSliderValue>0&&oldSliderValue<50&&(elements.volumeSliderIcon.innerHTML="volume_down"),oldSliderValue>=50&&(elements.volumeSliderIcon.innerHTML="volume_up"),elements.volumeSlider.value=oldSliderValue,elements.volumeSliderValue.innerHTML=oldSliderValue):(oldSliderValue=elements.volumeSlider.value,elements.volumeSliderIcon.innerHTML="volume_off",elements.volumeSlider.value=0,elements.volumeSliderValue.innerHTML=0)}function changeVolume(e){elements.volumeSliderValue.innerHTML=e.value,0==e.value&&(elements.volumeSliderIcon.innerHTML="volume_mute"),e.value>0&&e.value<50&&(elements.volumeSliderIcon.innerHTML="volume_down"),e.value>=50&&(elements.volumeSliderIcon.innerHTML="volume_up")}window.onload=function(){darkTheme="true"===(localStorage.getItem("darkTheme")||"true"),elements.darkTheme.checked=darkTheme??!0,switchTheme(elements.darkTheme.checked),loadAndConnect(),loginExpiredModal=new bootstrap.Modal(elements.loginExpiredModal),resetSettingsModal=new bootstrap.Modal(elements.resetSettingsModal),settingsOffcanvas=new bootstrap.Offcanvas(elements.settingsOffcanvas),copyLinkButton=new bootstrap.Popover(elements.copyLinkButton),queueTab=new bootstrap.Tab(elements.queueTab),approvalTab=new bootstrap.Tab(elements.approvalTab),historyTab=new bootstrap.Tab(elements.historyTab),USER.channel||(loginButton=new bootstrap.Popover(elements.loginButton)),elements.darkTheme.onchange=function(){switchTheme(this.checked),saveSettings()},elements.approvalQueue.onchange=function(){saveSettings(),elements.approvalTab.classList.contains("active")&&queueTab.show()},elements.toggleQueue.onchange=function(){queue_open=this.checked,this.checked?(elements.toggleQueueLabel.classList="btn btn-lg btn-danger",elements.toggleQueueLabel.innerHTML="Close<br>Queue"):(elements.toggleQueueLabel.classList="btn btn-lg btn-success",elements.toggleQueueLabel.innerHTML="Open<br>Queue")},elements.selectAll.addEventListener("click",(e=>{toggleEveryone(!0),saveSettings()})),elements.unselectAll.addEventListener("click",(e=>{toggleEveryone(!1),saveSettings()})),enableTooltips(),enablePopovers()};